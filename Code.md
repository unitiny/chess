## 开发日志

### 感想

应优先开发重要的模块，细节先保留（如界面设计，额外功能）

### 可优化

可添加个二进制指令表示棋局状态
[胜利][悔棋][将军][被将军]

棋局状态使用类
面板配置也可用类

攻击对方棋子也是移动的表现，可以复合
被将军后不应给机器发送消息，由于tip变空了，if判定成功

pos应定义一种类型

房间应有人数限制
全部玩家退出时应删除房间
房间人数未到齐不应开始

### 算法问题(已解决)

被将军不能保护
总喜欢吃棋子而被吃
为了将军而被吃棋子

### 深刻bug

- **chesses 数组更新页面却未复原**

  发现点击页面才能更新，小程序问题
  需要更新一个普通变量，才能调用AppData(),才能顺便更新数组

- 发现在h5视图不更新问题。。

  由于reactive在赋值时失去响应式。改为ref即可解决   

- 本地音频无法播放

    不能使用相对路径导入  

- 兼容性问题

    棋盘和棋子的相对位置
从底层搞起，先计算了rpx/px的比率，
从而开发出与预想的结果一样，原理真的很重要

- serverless函数超时，第二次请求才有效

- websocket多次发送（未解决）

- redisPool连接池获取的内容不是最新的

    go test有缓存，若未改动代码，结果和上次一样.
redis是单线程的，因此不会有并发问题

算法结果不合理（最大bug）

1 场景复现

2 分析该得分缘由

做法合理部分：

1 开发了绘制棋局函数，使情况更形象具体，辅助debug更有效

2 测试分析尽量从外部测试，优先定位错误的范围。然后不得已才从内部测试，查找漏洞。

3 尽量少修改已写代码，容易出错。

4 可把不相关代码注释掉，尽量减少其它影响。

5 没头绪时多猜测各种错误情况，万一灵光一闪。

结果：

1 炮检索走法函数有缺失，未考虑到和敌人隔着两个己方棋子的情况

2 兵检索走法函数有缺失，未考虑兵在己方阵营时被己方挡住兵前进情况

3 撤销走法函数有漏洞，会把很早之前的棋子给复活，应该只复活上一步死掉的棋子才对。
于是在每个棋子死亡时赋值e.depth来记录死亡时刻，但e.depth时递归的上下文变量，受到了子递归的影响，
导致该实现出错，费了好大功夫才查出漏洞。

### 数据记录

棋盘一格宽90rpx,高110rpx;起始坐标为10,80

### 计划任务

绝杀判断(暂缓)

### 已完成任务

6.17

选中样式
点击走动

7.26

吃掉棋子
回合制
使用ts，类，vue3 重构项目

7.27

走动限制规则
走动规则限制细节
将军判断

7.28

初始界面
开局配置

7.29

悔棋
提示弹窗

7.30

声音
聊天界面
上传体验小程序(改为h5，微信需要转为小游戏)
兼容处理
细节处理

7.31

部署h5

8.8

聊天
双人对战